{% extends "base.html" %}

{% block head %}
<script>
    function getUploadUrl() {
        return "{{ url_for('upload_image') }}";
    }
</script>
{% endblock %}

{% block body %}


<main id="main">
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">FOTOS</strong>
                <small></small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                DATOS GUARDADOS EXITOSAMENTE.
            </div>
        </div>
    </div>

    <!-- ======= Breadcrumbs ======= -->
    <div class="breadcrumbs">
        <div class="page-header d-flex align-items-center" style="background-image: url('assets/img/page-header.jpg');">
            <div class="container position-relative">
                <div class="row d-flex justify-content-center">
                    <div class="col-lg-6 text-center">
                        <h1>IPRODHA GIS APP: FOTO OBRAS GEORREFERENCIADAS</h1>
                    </div>
                </div>
            </div>
        </div>
        <nav>
            <div class="container">
                <ol>
                    <li><a href="/">Inicio</a></li>
                    <li>Mapas GIS</li>
                    <li>Fotos OBRAS</li>
                </ol>
            </div>
        </nav>
    </div><!-- End Breadcrumbs -->


    <!-- ======= Our Team Section ======= -->
    <section id="team" class="team pt-0">

        <div class="container" data-aos="fade-up">

            <div class="section-header">
                <span>CARGAR FOTOS OBRAS</span>
                <h2>CARGAR FOTOS OBRAS</h2>

            </div>

            <div class="row" data-aos="fade-up" data-aos-delay="100" style="padding-bottom: 30px;">
                <label for="imagen" class="form-label">Seleccionar Imagen</label>

                <div class="col input-group">
                    <input class="form-control" type="file" id="imagen" multiple>
                </div>
            </div>
            <div class="row" data-aos="fade-up" data-aos-delay="100" style="padding-bottom: 30px;">

                <div class="input-group mb-3">
                    <span class="input-group-text">Usuario</span>
                    <input type="text" class="form-control" placeholder="Usuario" aria-label="Usuario"
                        aria-describedby="usuario" id="usuario">
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">Latitud</span>
                    <input type="text" class="form-control" placeholder="Latitud" aria-label="Latitud" aria-describedby="Latitud"
                        id="lat">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">Longitud</span>
                    <input type="text" class="form-control" placeholder="Longitud" aria-label="Longitud" aria-describedby="Longitud"
                        id="long">
                </div>
                <div class="input-group mb-3">
                    <span class="input-group-text">Obra</span>
                    <input type="text" class="form-control" placeholder="Obra" aria-label="Obra" aria-describedby="obra"
                        id="obra">
                </div>

                <div class="input-group mb-3">
                    <span class="input-group-text">Observacion</span>
                    <input type="text" class="form-control" placeholder="Observacion" aria-label="Observacion"
                        aria-describedby="observacion" id="observacion">
                </div>


            </div>
            <div id="loading-screen"
                class="position-fixed top-0 start-0 end-0 bottom-0 d-flex align-items-center justify-content-center d-none"
                style="background: rgba(0, 0, 0, 0.5);">
                <div class="spinner-border text-light" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                <button onclick="submitForm()" class="btn btn-primary me-md-2" id="submit-button" type="button">GUARDAR
                    IMAGEN</button>
            </div>


        </div>
    </section><!-- End Our Team Section -->




</main><!-- End #main -->

<!-- ======= Footer ======= -->
<footer id="footer" class="footer">

    <div class="container">
        <div class="row gy-4">
            <div class="col-lg-5 col-md-12 footer-info">
                <a href="index.html" class="logo d-flex align-items-center">
                    <span>Comunidad BIM</span>
                </a>
                <p></p>
                <div class="social-links d-flex mt-4">
                    <a href="https://twitter.com/bim_misiones" class="twitter"><i class="bi bi-twitter"></i></a>
                    <a href="https://www.instagram.com/comunidad.bim.misiones/" class="instagram"><i
                            class="bi bi-instagram"></i></a>
                </div>
            </div>

            <div class="col-lg-2 col-6 footer-links">
                <h4>Links</h4>
                <ul>
                    <li><a href="/">Inicio</a></li>
                    <li><a href="#">Sobre CBIM</a></li>
                    <li><a href="#">Noticias</a></li>
                    <li><a href="#">GeoBim</a></li>
                    <li><a href="#">Mapas GIS</a></li>
                </ul>
            </div>

            <div class="col-lg-2 col-6 footer-links">

            </div>

            <div class="col-lg-3 col-md-12 footer-contact text-center text-md-start">
                <h4>¿Consultas? envianos un mail </h4>
                <p>
                    comunidad.bim.misiones@gmail.com </p>

            </div>

        </div>
    </div>

    <div class="container mt-4">
        <div class="copyright">
        </div>
        <div class="credits">
            <!-- All the links in the footer should remain intact. -->
            <!-- You can delete the links only if you purchased the pro version. -->
            <!-- Licensing information: https://bootstrapmade.com/license/ -->
            <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/logis-bootstrap-logistics-website-template/ -->
            Diseñado por <a href="https://bootstrapmade.com/">German Diaz</a>
            Imagenes proporcionadas por <a href="https://www.flaticon.es/">flaticon</a>

        </div>
    </div>

</footer><!-- End Footer -->
<!-- End Footer -->

<a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<div id="preloader"></div>

{% endblock %}

{% block script %}


<script>

async function submitForm() {
    const formData = new FormData();
    const files = document.getElementById('imagen').files;

    for (let i = 0; i < files.length; i++) {
        formData.append('image', files[i]);
    }

    formData.append('usuario', document.getElementById('usuario').value);
    formData.append('obra', document.getElementById('obra').value);
    formData.append('observacion', document.getElementById('observacion').value);
    formData.append('lat', document.getElementById('lat').value);
    formData.append('long', document.getElementById('long').value);

    const submitButton = document.getElementById('submit-button');
    const loadingScreen = document.getElementById('loading-screen');

    submitButton.disabled = true;
    loadingScreen.classList.remove('d-none');

    try {
        const response = await fetch(getUploadUrl(), {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            const jsonResponse = await response.json();
            console.log(jsonResponse);
        } else {
            console.error('Upload failed');
        }
    } catch (error) {
        console.error('An error occurred:', error);
    } finally {
        submitButton.disabled = false;
        loadingScreen.classList.add('d-none');
        showToast();
    }
}

    function showToast() {
            var toast = document.getElementById('liveToast');
            var bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }



</script>

<script src="{{ url_for('static', filename='js/jquery-1.10.2.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>


{% endblock %}